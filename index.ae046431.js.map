{"mappings":"qhBAAA,IAAAA,EAAAC,EAAA,S,oDAOA,MAAMC,EAAOC,SAASC,cAAc,UAC9BC,EAAiBF,SAASC,cAAc,kBAI9CF,EAAKI,iBAAiB,SAItBC,eAAgCC,GAC9B,IACE,GAA4B,OAAxBA,EAAIC,OAAOC,SACb,OAEF,MAEMC,EAFOH,EAAIC,OAAOG,QAAQ,MAEhBC,QAAQF,GAExBG,EAAYC,OAASJ,EAErB,MAAMK,QAAaF,EAAYG,cAI/B,IAAIC,SADgBJ,EAAYK,kBAChBC,QAShB,MAAMC,EAAY,iCADkBH,EAL/BI,KAAIC,GACIA,IAERC,MAAKD,GAAMA,EAAGE,KAAKC,SAAS,sBAGoCC,MAE/DC,GAAY,EAAAC,EAAAC,SAAUd,GAC5BY,EAAUG,MAAQV,EAElB,MAAMW,GAAa,EAAAC,EAAAH,SAASF,GAE5BvB,EAAe6B,UAAYF,EAE3B,IAAIG,EAAgBhC,SAASC,cAAc,gBACvCgC,EAAYjC,SAASC,cAAc,WAOvC,SAASiC,IACPD,EAAUE,UAAUC,OAAO,mB,CAE7B,SAASC,IACPnC,EAAe6B,UAAY,GAC3B7B,EAAeiC,UAAUG,IAAI,aAC7BtC,SAASuC,oBAAoB,UAAWC,GACxCtC,EAAeqC,oBAAoB,QAASE,GAC5CT,EAAcO,oBAAoB,QAASL,E,CAE7C,SAASM,EAAQE,GACI,WAAfA,EAAMC,MACRN,G,CAGJ,SAASI,EAAiBC,GACM,SAA1BA,EAAMpC,OAAOC,UAAiD,QAA1BmC,EAAMpC,OAAOC,UACnD8B,IAEEK,EAAMpC,SAAWoC,EAAME,eACzBP,IAGgC,YAA9BK,EAAMpC,OAAOI,QAAQY,OACvB,EAAAuB,EAAAlB,SAxEc,cAwEuBnB,EAAIiB,GAET,UAA9BiB,EAAMpC,OAAOI,QAAQY,OACvB,EAAAuB,EAAAlB,SA1EY,YA0EuBnB,EAAIiB,E,CAhC3CvB,EAAeiC,UAAUW,OAAO,aAChC5C,EAAeC,iBAAiB,QAASsC,GACzCzC,SAASG,iBAAiB,UAAWqC,GACrCR,EAAc7B,iBAAiB,QAAS+B,E,CAgCxC,MAAOa,GACPC,EAAAnD,GAASoD,OAAOC,QAAQH,EAAMI,Q,KA1ElC,MAAMxC,EAAc,IAAI,EAAAyC,EAAAzB","sources":["src/js/modal-open.js"],"sourcesContent":["import Notiflix from 'notiflix';\nimport FilmApi from './movieAPI';\nimport filmCard from '../templates/modal-film.hbs';\nimport fixObject from './fixObject';\n\nimport setFilmToLocalStorage from './setFilmToLocalStorage';\n\nconst ulEl = document.querySelector('.films');\nconst modalContainer = document.querySelector('#js-film-modal');\nconst LOCAL_WATCHED = 'watchedList';\nconst LOCAL_QUEUE = 'queueList';\n\nulEl.addEventListener('click', onFimlsListClick);\n\nconst filmAPIByID = new FilmApi();\n\nasync function onFimlsListClick(evt) {\n  try {\n    if (evt.target.nodeName === 'UL') {\n      return;\n    }\n    const item = evt.target.closest('li');\n\n    const id = item.dataset.id;\n\n    filmAPIByID.idFilm = id;\n\n    const film = await filmAPIByID.getFilmByID();\n\n    // =============================================================\n    const video = await filmAPIByID.getTrailerById();\n    let arr = video.results;\n    function findTrailer(arr) {\n      return arr\n        .map(el => {\n          return el;\n        })\n        .find(el => el.name.includes('Official Trailer'));\n    }\n    let objectWithTrailer = findTrailer(arr);\n    const movieLink = `https://www.youtube.com/embed/${objectWithTrailer.key}`;\n\n    const fixedFilm = fixObject(film);\n    fixedFilm.movie = movieLink;\n\n    const filmMarkUp = filmCard(fixedFilm);\n\n    modalContainer.innerHTML = filmMarkUp;\n\n    let trailerBtnRef = document.querySelector('.trailerShow');\n    let iframeRef = document.querySelector('.hidden');\n\n    modalContainer.classList.remove('is-hidden');\n    modalContainer.addEventListener('click', onModalFilmClick);\n    document.addEventListener('keydown', onClose);\n    trailerBtnRef.addEventListener('click', toggleIframe);\n\n    function toggleIframe() {\n      iframeRef.classList.toggle('trailer__youtube');\n    }\n    function closeModal() {\n      modalContainer.innerHTML = '';\n      modalContainer.classList.add('is-hidden');\n      document.removeEventListener('keydown', onClose);\n      modalContainer.removeEventListener('click', onModalFilmClick);\n      trailerBtnRef.removeEventListener('click', toggleIframe);\n    }\n    function onClose(event) {\n      if (event.code === 'Escape') {\n        closeModal();\n      }\n    }\n    function onModalFilmClick(event) {\n      if (event.target.nodeName === 'path' || event.target.nodeName === 'svg') {\n        closeModal();\n      }\n      if (event.target === event.currentTarget) {\n        closeModal();\n      }\n\n      if (event.target.dataset.name === 'watched') {\n        setFilmToLocalStorage(LOCAL_WATCHED, id, fixedFilm);\n      }\n      if (event.target.dataset.name === 'queue') {\n        setFilmToLocalStorage(LOCAL_QUEUE, id, fixedFilm);\n      }\n    }\n  } catch (error) {\n    Notiflix.Notify.failure(error.message);\n  }\n}\n"],"names":["$eWCmQ","parcelRequire","$ad3b8deda21ee6ba$var$ulEl","document","querySelector","$ad3b8deda21ee6ba$var$modalContainer","addEventListener","async","evt","target","nodeName","id","closest","dataset","$ad3b8deda21ee6ba$var$filmAPIByID","idFilm","film","getFilmByID","arr1","getTrailerById","results","movieLink","map","el","find","name","includes","key","fixedFilm","$6Jpgb","default","movie","filmMarkUp","$eXQeU","innerHTML","trailerBtnRef","iframeRef","toggleIframe","classList","toggle","closeModal","add","removeEventListener","onClose","onModalFilmClick","event","code","currentTarget","$2ST4D","remove","error","$parcel$interopDefault","Notify","failure","message","$9Bkxl"],"version":3,"file":"index.ae046431.js.map"}